<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Cevap Anahtarı</title>
  <style>
    body{font-family:sans-serif;background:#111;color:#eee;padding:20px}
    textarea{width:100%;min-height:200px}
    button{margin-top:10px;padding:8px 16px}
    .muted{color:#bbb;font-size:14px;margin-top:6px}
  </style>
</head>
<body>
  <h1>Cevap Anahtarı</h1>
  <p>İstediğin gibi gir (ör: <code>1. B</code>, <code>B C D A ...</code>, başlıklı metin). Yalnızca bağımsız A–E harfleri sırayla alınır.</p>
  <textarea id="keyBox"></textarea>
  <div class="muted">İpucu: Kopyaladığın metinde başlıklar kalabilir; sorun değil.</div>
  <br>
  <button onclick="saveKey()">Kaydet</button>

  <script>
    
    const tests = { TR:40, SOC:20, MATH:40, SCI:20 };

    
    function extractChoices(text){
    
      const re = /(?:^|[^A-Za-zÇçĞğİıÖöŞşÜü0-9])(?:\d+\s*[\.\-:]?\s*)?([A-Ea-e])(?=[^A-Za-zÇçĞğİıÖöŞşÜü0-9]|$)/g;
      const out = [];
      let m;
      while((m = re.exec(text)) !== null){
        out.push(m[1].toUpperCase());
      }
      return out;
    }

    function saveKey(){
      const rawText = document.getElementById("keyBox").value;
      const raw = extractChoices(rawText);

      const expected = Object.values(tests).reduce((a,b)=>a+b,0); // 120
      if(raw.length === 0){
        alert("Hiç cevap bulunamadı. Lütfen metni kontrol et.");
        return;
      }

      if(raw.length < expected){
        if(!confirm(`Bulunan cevap sayısı: ${raw.length}/${expected}. Eksikler boş bırakılacak. Devam edilsin mi?`)){
          return;
        }
      }else if(raw.length > expected){
        if(!confirm(`Bulunan cevap sayısı: ${raw.length}/${expected}. Fazla olanlar yok sayılacak. Devam edilsin mi?`)){
          return;
        }
      }

      let answerKey = { TR:{}, SOC:{}, MATH:{}, SCI:{} };
      let idx = 0;
      for(const k of Object.keys(tests)){
        for(let i=1;i<=tests[k];i++){
          answerKey[k][i] = raw[idx++] || "";
        }
      }

      let state = JSON.parse(localStorage.getItem("tyt-optik-state") || "{}");
      state.answerKey = answerKey;
      localStorage.setItem("tyt-optik-state", JSON.stringify(state));

      alert("Cevap anahtarı kaydedildi! (Bulunan: "+raw.length+" / Beklenen: "+expected+")");
    }
  </script>
</body>
</html>
